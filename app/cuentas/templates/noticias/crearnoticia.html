<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Crear Noticia</title>
  <script type="module" src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.esm.js"></script>
  <script nomodule src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.js"></script>
  <style>
    * {
      box-sizing: border-box;
    }

    body {
      font-family: sans-serif;
      padding: 20px;
      max-width: 600px;
      margin: auto;
      background-color: #0f172a;
      color: #f1f5f9;
      transition: background-color 0.3s, color 0.3s;
    }

    body.light {
      background-color: #f1f5f9;
      color: #0f172a;
    }

    h1 {
      text-align: center;
      margin-bottom: 30px;
    }

    input, textarea, select, button {
      display: block;
      width: 100%;
      margin-bottom: 15px;
      padding: 10px;
      font-size: 16px;
      border-radius: 8px;
      border: 1px solid #ccc;
    }

    input:focus, textarea:focus, select:focus {
      border-color: #4caf50;
      outline: none;
    }

    button {
      background-color: #4caf50;
      color: white;
      border: none;
      cursor: pointer;
      padding: 12px;
      font-size: 18px;
      border-radius: 8px;
      transition: background-color 0.3s;
    }

    button:hover {
      background-color: #45a049;
    }

    #drop-area {
      border: 2px dashed #ccc;
      border-radius: 10px;
      padding: 20px;
      text-align: center;
      margin-bottom: 15px;
      cursor: pointer;
    }

    #drop-area.highlight {
      border-color: #4caf50;
      background-color: #f0fff0;
    }

    #preview {
      max-width: 100%;
      margin-top: 10px;
      border-radius: 12px;
    }

    #toggle-theme {
      position: absolute;
      top: 20px;
      right: 20px;
      font-size: 28px;
      cursor: pointer;
      color: inherit;
    }

  </style>
</head>
<body class="light">
  <ion-icon id="toggle-theme" name="moon"></ion-icon>
  <h1>Crear Noticia</h1>
  <form id="form-noticia" onsubmit="event.preventDefault(); solicitarPublicacion();">
    <input type="text" id="titulo" placeholder="Título de la Noticia" required>

    <div id="drop-area">
      <p>Arrastra una imagen aquí o haz clic para seleccionar</p>
      <input type="file" id="imagen" accept="image/*" style="display: none;" required>
      <img id="preview" src="" alt="" style="display:none;">
    </div>

    <textarea id="descripcion" placeholder="Descripción de la noticia" rows="6" required></textarea>
    <select id="autor">
      <option value="Martin">Martin</option>
      <option value="Damían">Damían</option>
      <option value="Emiliano">Emiliano</option>
    </select>
    <button type="submit">Solicitar publicación</button>
  </form>

  <script>
    const dropArea = document.getElementById("drop-area");
    const fileInput = document.getElementById("imagen");
    const preview = document.getElementById("preview");
    let imagenBase64 = "";

    dropArea.addEventListener("click", () => fileInput.click());

    fileInput.addEventListener("change", handleFiles);

    ["dragenter", "dragover"].forEach(eventName => {
      dropArea.addEventListener(eventName, e => {
        e.preventDefault();
        dropArea.classList.add("highlight");
      }, false);
    });

    ["dragleave", "drop"].forEach(eventName => {
      dropArea.addEventListener(eventName, e => {
        e.preventDefault();
        dropArea.classList.remove("highlight");
      }, false);
    });

    dropArea.addEventListener("drop", e => {
      const dt = e.dataTransfer;
      const files = dt.files;
      fileInput.files = files;
      handleFiles();
    });

    function handleFiles() {
      const file = fileInput.files[0];
      if (!file) return;

      const reader = new FileReader();
      reader.onload = e => {
        imagenBase64 = e.target.result;
        preview.src = imagenBase64;
        preview.style.display = "block";
      };
      reader.readAsDataURL(file);
    }

    function solicitarPublicacion() {
      const titulo = document.getElementById("titulo").value.trim();
      const descripcion = document.getElementById("descripcion").value.trim();
      const autor = document.getElementById("autor").value;

      if (!titulo || !descripcion || !imagenBase64) {
        alert("Todos los campos deben estar completos, incluyendo la imagen.");
        return;
      }

      const noticia = {
        id: Date.now(),
        titulo,
        imagen: imagenBase64,
        descripcion,
        autor,
        fecha: new Date().toLocaleString()
      };

      const noticiasSolicitadas = JSON.parse(localStorage.getItem("noticiasSolicitadas")) || [];
      noticiasSolicitadas.push(noticia);
      localStorage.setItem("noticiasSolicitadas", JSON.stringify(noticiasSolicitadas));

      const solicitudesPendientes = JSON.parse(localStorage.getItem("solicitudesPendientes")) || [];
      solicitudesPendientes.push(noticia);
      localStorage.setItem("solicitudesPendientes", JSON.stringify(solicitudesPendientes));

      alert("Solicitud enviada correctamente.");
      document.getElementById("form-noticia").reset();
      preview.style.display = "none";
      imagenBase64 = "";
    }

    // Cargar tema desde localStorage
    window.addEventListener("load", () => {
      const savedTheme = localStorage.getItem("tema");
      if (savedTheme) {
        document.body.classList.add(savedTheme);
        document.getElementById("toggle-theme").name = savedTheme === "light" ? "moon" : "sunny";
      }
    });

    // Modo oscuro / claro
    const toggleTheme = document.getElementById("toggle-theme");
    toggleTheme.addEventListener("click", () => {
      const currentTheme = document.body.classList.contains("dark") ? "dark" : "light";
      const newTheme = currentTheme === "dark" ? "light" : "dark";

      document.body.classList.remove(currentTheme);
      document.body.classList.add(newTheme);
      localStorage.setItem("tema", newTheme); // Guardar el tema en localStorage

      toggleTheme.name = newTheme === "dark" ? "sunny" : "moon";
    });
  </script>
</body>
</html>
