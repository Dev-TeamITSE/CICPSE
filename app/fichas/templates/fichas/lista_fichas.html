<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Listado de Fichas</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="p-6 bg-gray-100">


{% if messages %}
  <div id="messages" class="fixed inset-0 flex items-center justify-center z-50">
    {% for message in messages %}
      <div class="bg-green-100 border-4 border-green-400 text-green-800 px-8 py-6 rounded-lg shadow-lg relative w-full max-w-md mx-auto" style="min-height: 150px;">
        <span class="block text-center text-lg font-semibold">{{ message }}</span>
        <button onclick="document.getElementById('messages').remove()" 
                class="absolute top-2 right-2 text-green-700 hover:text-red-500">
          ✖
        </button>
      </div>
    {% endfor %}
  </div>
{% endif %}




  <!-- Encabezado -->
<body class="p-6 bg-gray-100">

  <!-- Botón Volver al Menú -->
  
<!-- Botón Volver al menú (idéntico al de formulario.html) -->
<div class="flex justify-end mb-2">
  <a href="{% url 'cuentas:profile' %}" class="inline-flex items-center text-blue-600 hover:text-blue-800 font-medium">
    <svg class="h-5 w-5 mr-1" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"
         xmlns="http://www.w3.org/2000/svg">
      <path stroke-linecap="round" stroke-linejoin="round" d="M15 19l-7-7 7-7" />
    </svg>
    Inicio
  </a>
</div>




  <!-- Encabezado -->
  <div class="flex justify-between items-center mb-4">
    <h1 class="text-2xl font-bold">📋 Listado de Fichas Registradas</h1>
    <a href="{% url 'fichas:cargar_ficha' %}" class="bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600">
      ➕ Nueva Ficha
    </a>
  </div>


  <!-- Formulario de eliminación -->
  <form id="formEliminar" method="POST" action="{% url 'fichas:eliminar_fichas' %}">
    {% csrf_token %}
    <div class="overflow-x-auto">
      <table class="min-w-full bg-white border border-gray-300 shadow-sm rounded">
        <thead class="bg-gray-200">
          <tr>
            <th class="p-2 border text-center">
              <input type="checkbox" id="checkAll">
            </th>
            <th class="p-2 border">N°</th>
            <th class="p-2 border">Nombre</th>
            <th class="p-2 border">Fecha</th>
            <th class="p-2 border">Acciones</th>
          </tr>
        </thead>
        <tbody>
          {% for ficha in fichas %}
            <tr class="hover:bg-gray-50">
              <td class="p-2 border text-center">
                <input type="checkbox" name="fichas_seleccionadas" value="{{ ficha.id }}" class="checkboxFicha">
              </td>
              <td class="p-2 border">{{ ficha.nro_id }}</td>
              <td class="p-2 border">{{ ficha.nombre_descriptivo }}</td>
              <td class="p-2 border">{{ ficha.fecha_registro }}</td>
              <td class="p-2 border">
                <a href="{% url 'ficha_detalle' ficha.id %}" class="text-blue-600 hover:underline">Ver / Editar</a>
              </td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>

    <!-- Botón de eliminar -->
    <div class="flex justify-end mt-4">
      <button type="button" id="btnEliminar" class="bg-red-500 text-white px-4 py-2 rounded opacity-50 cursor-not-allowed" disabled>
        🗑️ Eliminar seleccionados
      </button>
    </div>
  </form>

  <!-- Modal de confirmación -->
  <div id="modalConfirmacion" class="fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 hidden">
    <div class="bg-white p-6 rounded shadow-md max-w-md w-full">
      <h2 class="text-xl font-bold mb-4">¿Confirmar eliminación?</h2>
      <p class="mb-6">¿Estás seguro de que deseas eliminar los elementos seleccionados? Esta acción no se puede deshacer.</p>
      <div class="flex justify-end space-x-4">
        <button type="button" id="btnCancelar" class="px-4 py-2 bg-gray-200 rounded hover:bg-gray-300">Cancelar</button>
        <button type="submit" form="formEliminar" class="px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700">Aceptar</button>
      </div>
    </div>
  </div>

  <!-- Script de comportamiento -->
  <script>
    const checkAll = document.getElementById('checkAll');
    const checkboxes = document.querySelectorAll('.checkboxFicha');
    const btnEliminar = document.getElementById('btnEliminar');
    const modal = document.getElementById('modalConfirmacion');
    const btnCancelar = document.getElementById('btnCancelar');

    // Marcar/desmarcar todos
    checkAll.addEventListener('change', () => {
      checkboxes.forEach(cb => cb.checked = checkAll.checked);
      toggleBoton();
    });

    // Habilitar botón si al menos un checkbox está marcado
    checkboxes.forEach(cb => cb.addEventListener('change', toggleBoton));

    function toggleBoton() {
      const haySeleccion = [...checkboxes].some(cb => cb.checked);
      btnEliminar.disabled = !haySeleccion;
      btnEliminar.classList.toggle('opacity-50', !haySeleccion);
      btnEliminar.classList.toggle('cursor-not-allowed', !haySeleccion);
    }

    // Mostrar el modal de confirmación
    btnEliminar.addEventListener('click', () => {
      modal.classList.remove('hidden');
    });

    // Cancelar la eliminación
    btnCancelar.addEventListener('click', () => {
      modal.classList.add('hidden');
    });
  </script>

</body>
</html>

